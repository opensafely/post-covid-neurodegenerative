# Impact of vaccination on the association of COVID-19 with neurodegenerative diseases: an OpenSAFELY cohort study using linked electronic health records

Abstract: The incidence of neurodegenerative diseases _____ after COVID-19 diagnosis. How COVID-19 vaccination and different SARS-CoV-2 variants impact on this increase is unclear. The objective was to quantify associations between COVID-19 diagnosis and neurodegenerative diseases in different cohorts (prevaccinated, vaccinated, and unvaccinated) and variant eras in England.

This project compares three cohorts: prevaccination, vaccinated, and unvaccinated. This repository creates the results for the pre-vaccinated, vaccinated and electively unvaccinated cohorts. 

You can run this project via [Gitpod](https://gitpod.io) in a web browser by clicking on this badge: [![Gitpod ready-to-code](https://img.shields.io/badge/Gitpod-ready--to--code-908a85?logo=gitpod)](https://gitpod.io/#https://github.com/opensafely/post-covid-neurodegenerative).

-   The preprint can be found
-   The project protocol whih contains in depth deatils of the anlaysis plan can be found 
-   Analysis scripts are in the [`analysis`](./analysis) directory
-   If you are interested in how we defined our code lists, look in the [codelists](https://github.com/opensafely/post-covid-neurodegenerative/tree/main/codelists) directory
-   Developers and epidemiologists interested in the framework should review the [`OpenSAFELY documentation`](https://docs.opensafely.org/)

### project.yaml

The [`project.yaml`](./project.yaml) defines project actions, run-order and dependencies for all analysis scripts. **This file should *not* be edited directly**. To make changes to the yaml, edit and run the [`create_project.R`](./analysis/create_project.R) script instead. Project actions are then run securely using [OpenSAFELY Jobs](https://jobs.opensafely.org/repo/https%253A%252F%252Fgithub.com%252Fopensafely%252Fpost-covid-neurodegenerative). Details of the purpose and any published outputs from this project can be found at this link as well.

Below is a description of each action in the [`project.yaml`](./project.yaml). Arguments are denoted by {arg} in the action name.

-   `vax_eligibility_inputs`
    -   Runs [`metadates.R`](./analysis/metadates.R) which creates metadata for aspects of the study design which are required for the `generate_study_population` actions.
    -   Creates dataframes that contain dates for each phase of vaccination and conditions for defining JCVI vacciantion groups
-   `generate_study_population_{cohort}`
    -   There are three `generate_study_population` scripts that are run to create the three study populations: prevaccinated (prevax), vaccinated (vax) and electivively unvaccinated (unvax). These are [`study_definition_prevax.py`](./analysis/study_definition_prevax.py), [`study_definition_vax.py`](./analysis/study_definition_vax.py), [`study_definition_unvax.py`](./analysis/study_definition_unvax.py) and [`study_definition_prelim.py`](./analysis/study_definition_prelim.py).
    -   These scripts are used to define JCVI groups, vaccine variables, variables used to apply eligibility criteria, outcome variables and covariate variables. Common variables used in all three scripts can be found in [`common_variables.py`](./analysis/common_variables.py).
-   `preprocess data - {cohort}`
    -   Runs [`preprocess_data.R`](./analysis/preprocess/preprocess_data.R) to apply dataframe tidying to `input_{cohort}.rds` (generated by `generate_study_population_{cohort}`
    -   Tidies vaccine variables, determines patient study index date, creates addtional variables (e.g. covid phenotype), tidies dataset and ensures all variables are in the correct format e.g. numeric, character etc.
-   `stage1_data_cleaning_{cohort}`
    -   Runs [`Stage1_data_cleaning.R`](./analysis/preprocess/Stage1_data_cleaning.R)
    -   Applies quality assurance rule and inclusion/exclusion criteria
    -   Outputted dataset is analysis ready
-   `table1_{cohort}`
    -   Runs [`table1.R`](./analysis/table1.R) which calculates descriptive statistics for pre- and post-exposure events for all outcomes and subgroups.
    -   Used for Table 1 in the manuscript
-   `table2_{cohort}`
    -   Runs [`table2.R`](./analysis/descriptives/table2.R) which calculates pre- and post-exposure event counts and person days of follow-up for all outcomes and subgroups.
    -   Used for Table 2 in the manuscript
-   `venn - {cohort}`
    -   Runs [`venn.R`](./anlaysis/descriptives/venn.R)
    -   Creates venn diagram data for all outcomes reporting where outcomes are sourced from i.e primary care, secondary care or deaths data
-   `make_model_input-{name}`
    -   Runs [`make_model_input.R`](./analysis/model/make_model_input.R) which prepares datasets for all the outcomes and subgroups.
    -   Combines each outcome and subgroup in one formatted .rds file
-   `describe_model_input-{name}`
    -   Runs [`describe_file.R`](./analysis/describe_file.R) which calculates counts, and descriptive statistics for the outcomes and covariates used in the cox models.
    -   Combines all the information in one formatted .txt file
-   `cox_ipw-{name}`
    -   Runs `cox-ipw`, a R reusable action for the OpenSAFELY framework.
    -   Detailed descriptions of each arguments/options used to fit the cox models can be found in the [`README`](https://github.com/opensafely-actions/cox-ipw/blob/main/README.md) file.
-   `make_model_output`
    -   Runs [`make_model_output.R`](./analysis/model/make_model_output.R) which combines all the R results in one formatted .csv file.

### Creating the study population

In OpenSAFELY a study definition is a formal specification of the data that you want to extract from the OpenSAFELY database. This includes:

-   the patient population (dataset rows)
-   the variables (dataset columns)
-   the expected distributions of these variables for use in dummy data

Further details on creating the study population can be found in the [`OpenSAFELY documentation`](https://docs.opensafely.org/study-def/).

The contents of this repository MUST NOT be considered an accurate or valid representation of the study or its purpose. This repository may reflect an incomplete or incorrect analysis with no further ongoing work. The content has ONLY been made public to support the OpenSAFELY [open science and transparency principles](https://www.opensafely.org/about/#contributing-to-best-practice-around-open-science) and to support the sharing of re-usable code for other subsequent users. No clinical, policy or safety conclusions must be drawn from the contents of this repository.

# About the OpenSAFELY framework

The OpenSAFELY framework is a Trusted Research Environment (TRE) for electronic health records research in the NHS, with a focus on public accountability and research quality.

Read more at [OpenSAFELY.org](https://opensafely.org).

# Licences

As standard, research projects have a MIT license.

